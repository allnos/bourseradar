<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Radar Boursier : Opportunit√©s Buffett</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #f0f2f5; margin: 0; padding: 20px; }
        .container { max-width: 1200px; margin: 0 auto; background: white; padding: 20px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        h1 { color: #2c3e50; text-align: center; }
        h2.category { margin-top: 40px; padding: 10px 0; border-bottom: 2px solid #34495e; color: #34495e; }
        .update-time { text-align: center; color: #7f8c8d; font-size: 0.9em; margin-bottom: 20px; }
        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        th { background: #34495e; color: white; padding: 12px; text-align: left; }
        td { padding: 12px; border-bottom: 1px solid #ddd; }
        tr:nth-child(even) { background-color: #f9f9f9; }
        tr:hover { background-color: #e8f4f8; }
        .pe-tag { color: white; padding: 3px 8px; border-radius: 4px; font-weight: bold; display: inline-block; min-width: 40px; text-align: center; }
    </style>
</head>
<body>

<div class="container">
    <h1>üåç Radar Boursier : Opportunit√©s Monde (Crit√®res Buffett)</h1>
    <p class="update-time" id="lastUpdate">Chargement des donn√©es...</p>

    <h2 class="category">1. Cat√©gorie : Sous-√©valu√© (P/E Ratio < 15) <span style="font-size: 0.8em; color: #27ae60;">üü¢</span></h2>
    <table id="table-undervalued">
        <thead>
            <tr>
                <th>Symbole</th>
                <th>Soci√©t√©</th>
                <th>Secteur</th>
                <th>P/E Ratio</th>
                <th>ROE</th>
                <th>Prix</th>
            </tr>
        </thead>
        <tbody id="tbody-undervalued">
            </tbody>
    </table>

    <h2 class="category">2. Cat√©gorie : Qualit√©/Prix (P/E 15-25 ET ROE > 15%) <span style="font-size: 0.8em; color: #2980b9;">üîµ</span></h2>
    <table id="table-quality">
        <thead>
            <tr>
                <th>Symbole</th>
                <th>Soci√©t√©</th>
                <th>Secteur</th>
                <th>P/E Ratio</th>
                <th>ROE</th>
                <th>Prix</th>
            </tr>
        </thead>
        <tbody id="tbody-quality">
            </tbody>
    </table>

</div>

<script>
    const jsonPath = 'data.json';
    
    // Fonction pour cr√©er une ligne de tableau
    function createRow(stock, badgeColor) {
        return `<tr>
            <td><b>${stock.symbol}</b></td>
            <td>${stock.name}</td>
            <td>${stock.sector}</td>
            <td><span class="pe-tag" style="background-color:${badgeColor}">${stock.pe}</span></td>
            <td>${stock.roe}%</td>
            <td>${stock.price} ${stock.currency}</td>
        </tr>`;
    }

    // Fonction pour charger les donn√©es
    fetch(jsonPath)
        .then(response => {
            if (!response.ok) {
                throw new Error(`Erreur HTTP: ${response.status}. Le fichier ${jsonPath} n'a pas √©t√© trouv√© ou g√©n√©r√©.`);
            }
            return response.json();
        })
        .then(jsonData => {
            document.getElementById('lastUpdate').textContent = "Derni√®re mise √† jour : " + jsonData.last_updated;
            
            const tbodyUndervalued = document.getElementById('tbody-undervalued');
            const tbodyQuality = document.getElementById('tbody-quality');
            
            if(jsonData.data.length === 0) {
                // Si aucune donn√©e n'est trouv√©e, on affiche un message dans les deux sections
                const noDataRow = "<tr><td colspan='6' style='text-align:center'>Aucune valeur trouv√©e selon ce crit√®re aujourd'hui.</td></tr>";
                tbodyUndervalued.innerHTML = noDataRow;
                tbodyQuality.innerHTML = noDataRow;
                return;
            }

            let countUndervalued = 0;
            let countQuality = 0;

            jsonData.data.forEach(stock => {
                let rowHtml;

                if (stock.tag === "Sous-√©valu√©") {
                    rowHtml = createRow(stock, "#27ae60"); // Vert
                    tbodyUndervalued.innerHTML += rowHtml;
                    countUndervalued++;
                } else if (stock.tag === "Qualit√©/Prix") {
                    rowHtml = createRow(stock, "#2980b9"); // Bleu
                    tbodyQuality.innerHTML += rowHtml;
                    countQuality++;
                }
            });

            // Affichage des messages si une cat√©gorie est vide
            if (countUndervalued === 0) {
                tbodyUndervalued.innerHTML = "<tr><td colspan='6' style='text-align:center'>Aucune valeur trouv√©e selon ce crit√®re aujourd'hui.</td></tr>";
            }
            if (countQuality === 0) {
                tbodyQuality.innerHTML = "<tr><td colspan='6' style='text-align:center'>Aucune valeur trouv√©e selon ce crit√®re aujourd'hui.</td></tr>";
            }
        })
        .catch(error => {
            document.getElementById('lastUpdate').textContent = "Erreur de chargement des donn√©es. Le robot n'a pas encore fini ou a √©chou√©. D√©tail: " + error.message;
            console.error('Erreur:', error);
        });
</script>

</body>
</html>
